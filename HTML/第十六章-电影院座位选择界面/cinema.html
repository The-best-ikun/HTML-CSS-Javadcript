<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>电影院座位选择界面</title>
        <!-- 引入bootstrap文件 -->
        <link href="bootstrap-3.4.1-dist/css/bootstrap.min.css" rel="stylesheet">
        <!-- 最好把jquery放在前面引用 -->
        <script src="bootstrap-3.4.1-dist/dist/jquery.min.js"></script>
        <script src="bootstrap-3.4.1-dist/js/bootstrap.min.js"></script>
        <!-- 引入Vue文件 -->
        <script src="vue/vue.js"></script>


        <style>
            .seat{
                float: left;
                width: 40px;
                height: 40px;
                margin: 5px 10px;
                cursor:pointer;
                background-size: contain;
                background-repeat: no-repeat;
                border-radius: 3px;
            }
            /* 可选座位样式，也就是改个src */
            .spaceSeat{
                background-image:url("images/0.jpg") ;
            }
            /* 成功购买座位 */
            .successfulSeat{
                background-image: url("images/1.jpg") ;
            }
            /* 选中状态座位 */
            .activeSeat{
                background-image: url("images/2.jpg") ;
            }
            /* 被选座位 */
            .noSeat{
                background-image:url("images/3.jpg") ;
            }
            /* 禁用座位 */
            .noUseSeat{
                background-image:url("images/4.jpg") ;
            }
            #app ul{
                list-style: none;
                /* 设定宽度，不然一维数组遍历会使他们在一行 */
                width: 550px;
            }
            /* 定义座位前的屏幕 */
            .screen{
                width: 500px;
                text-align: center;
                margin: 25px;
                font-size: larger;
                border: 3px solid black;
            }
            .ui{
                /* flex是一种布局模式，它允许您对容器内的项进行对齐和分布空间,设定为浮动是因为之前的座位类也设了浮动 */
                float: left;
                display: flex;
                height:40px;
                
                justify-content: center;
                align-items: center;
            }

            .screenRight{
                margin-top: 30px;
                border-radius: 5px;
                /* background-color: rgba(149, 171, 161, 0.531); */
            }
            .movieInfo{
                background-color: black;
                border-radius: 10px;
                
            }
           .embed-responsive-item{
            border-radius: 5px;
            margin: 30px;
           }
           .activeSeatDisplay{
                background-color: aqua;
                border: 3px solid black;
                border-radius: 5px;
                margin-left: 10px;
           }
           .buttonPanel{
            width: 100%;
            margin-top: 40px;
           }

        </style>
    </head>

    <body>
        <div class="container" id="app">
            <div class="row">
                <!-- 左半部分是用来选座的 -->
                <div class="col-md-6">
                    <!-- 选座区分上下两部分，上半部分选座，下半部分做UI提示和影票购买信息 -->
                    <div class="row">
                        <div class="screen">屏幕</div>
                        <ul>
                            <li v-for="(item,index) in seatFlag" :key="index" class="seat"
                            :class="{'noSeat': seatFlag[index]==3,
                                    'spaceSeat':seatFlag[index]==0,
                                    'noUseSeat':seatFlag[index]==4,
                                    'activeSeat':seatFlag[index]==2,
                                    'successfulSeat':seatFlag[index]==1}"
                                    @click="handleClick(index)"></li>
                        </ul>
                    </div>
                    <!-- UI提示区 -->
                    <div class="row">
                        <hr>
                        <div class="row">
                            <div class="col-md-2">
                                <div class=" seat spaceSeat"></div>
                                <div class="ui">空位置</div>
                            </div>
                            <div class="col-md-2">
                                <div class=" seat noSeat"></div>
                                <div class="ui">已售出位置</div>
                            </div>
                            <div class="col-md-2">
                                <div class=" seat activeSeat"></div>
                                <div class="ui">选中位置</div>
                            </div>
                            <div class="col-md-2">
                                <div class=" seat noUseSeat"></div>
                                <div class="ui">禁用位置</div>
                            </div>
                            <div class="col-md-2">
                                <div class=" seat successfulSeat"></div>
                                <div class="ui">已购位置</div>
                            </div>
                        </div>

                        <div class="row" style="margin-left: 0;">
                            <!-- 给出文字提示 -->
                            <strong style="color: rgb(1, 187, 239);">再次单击选中位置可取消选中</strong>
                            <br/>
                            <br/>
                            <strong style="color: rgb(1, 187, 239);">最多可定五张票</strong>
                            <br/>
                            <br/>
                            <strong v-if="maxFlag==true" style="color: rgb(222, 36, 36);">已达到可选最大值</strong>
                        </div>
                    </div>
                    <br/>
                    <!-- 这里放购票信息也行 -->
                    <div class="row">
                        
                        <strong>已选座位：</strong>
                        <span  class="activeSeatDisplay" v-for="(item, index) in curSeatDisplay " :key="index">
                            {{ item }}
                        </span>
                        <br>
                        <br>
                        <strong>总价：</strong>
                        <span>￥ {{totalPrice|priceFormat}}</span>
                        <!-- 后续可能在里面加入其他按钮 -->
                        <div class="buttonPanel">
                        <!-- 点击后可添加模态框进一步填写信息，这里就不写了 -->
                        <button class="btn btn-primary" type="button" @click="shop">确认购买</button>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 screenRight">
                    <!-- 电影信息提示行 -->
                    <div class="row movieInfo">
                        <!-- 先拿视频放在最上面,直接用embed有点问题 -->
                        <!-- <embed src="https://vd3.bdstatic.com/mda-jg0pbf8srgdf51pa/hd/mda-jg0pbf8srgdf51pa.mp4"
                        autostart="true" hidden="true" starttime=00:00 volume="90" width="800" height="600"></embed> -->

                            <!-- 这个放了视频再放其他信息就有滚动条了，信息太多了 -->
                            <!-- 4:3 aspect ratio
                            <div class="embed-responsive  embed-responsive-16by9" >
                                <iframe allowfullscreen autoplay muted
                                class="embed-responsive-item" 
                                v-bind:src=movieInfo.movieVideo></iframe>
                            </div>
                            <div style="font-size: larger; color: aqua; padding-left: 30px;">{{movieInfo.name}}最新预告视频</div> -->
                        </div>

                        <br>

                        <div class="alert alert-info" role="alert">电影主要信息</div>

                        <!-- 电影主要信息 -->
                        <div class="media">
                            <div class="media-left">
                              <a href="#">
                                <img class="media-object" v-bind:src=movieInfo.movieImgs[0] alt="小黄人大眼萌"
                                style="height:100px;width:auto; border-radius:5px;">
                              </a>
                            </div>
                            <div class="media-body">
                              <h4 class="media-heading">小黄人大眼萌</h4>
                                
                                <p>剧情介绍：{{movieInfo.introduction}}</p>
                              
                            </div>
                          </div>
                          <div class="panel panel-default">
                            <div class="panel-heading">
                              <h3 class="panel-title">电影详细信息</h3>
                            </div>
                            <div class="panel-body">
                                <p>英文名：{{movieInfo.nameEnglish}}</p>
                                <p>视听效果：{{movieInfo.copyRight}}</p>
                                <p>电影类型：{{movieInfo.storyType}}</p>
                                <p>电影时长：{{movieInfo.timeLength}}</p>
                                <p>上映时间：{{movieInfo.timeShow}}</p>
                                <p>放映地点：{{movieInfo.cinema}}  {{movieInfo.room}}</p>
                                <p>放映时间：{{movieInfo.time}}</p>
                                <p>票价:{{movieInfo.unitPrice}}</p>

                            </div>
                          </div>
                    </div>
                </div>
            </div>
        </div>

    </body>
    <script>
        var vm=new Vue({
            el:"#app",
            data:{
                seatFlag:[
                    // 5行8列
                    // 0表示未选
                    // 3表示已被他人选择
                    // 4表示座位因为某些特殊原因不可选用
                    // 1表示被自己选中，并成功购买
                    // 2表示选中状态，但还未购买
                    4,0,0,0,0,0,0,4,
                    0,0,3,3,3,3,0,0,
                    0,3,0,3,0,0,3,0,
                    0,0,0,0,0,0,0,0,
                    4,0,0,0,0,0,0,4,
                ],
                // 座位为8列
                seatCol:8,
                // 初始选中数
                count:0,
                // 选中数组存起来，在确认订单时，提交这部分内容给服务器
                curSeat:[],
                // 这里会根据选中数组，存储座位的行列信息
                curSeatDisplay:[],
                // 是否达到最大数
                maxFlag:false,
                // 电影信息
                movieInfo:{
                    name:'小黄人大眼萌',
                    nameEnglish:'Minions',
                    introduction:'《小黄人》围绕小黄人们的“前格鲁时代”展开叙述，并特别追溯了小黄人的起源。小黄人总是忠诚地为主人提供各种服务，兢兢业业，毫无怨言，直到它们失手“害死”每一任主人。在痛苦地失去一个又一个主人后，被困在冰洞之内小黄人们愈发焦躁不安，他们决定挺身而出，去到花花世界，再次寻找可以效劳的主人。',
                    copyRight:'英文3D',
                    // 做轮播图图片路径数组,太麻烦了，不做了
                    movieImgs:['images/1.webp'],
                    // 短视频电影介绍的视频路径
                    movieVideo:'video/1.mp4',
                    storyType:'喜剧',
                    timeLength:'91分钟',
                    timeShow:'2015年9月13日（中国）',//上映时间
                    cinema:'新世界影城',
                    room:'1号影厅',
                    time:'2024-4-9 周二 19:30',//播放时间
                    unitPrice:49
                }

            },
            methods:{
                handleClick:function(index){
                    // 如果点击的是选中位置，就会取消选中
                    if(vm.seatFlag[index]==2){
                        vm.$set(vm.seatFlag,index,0);//这个函数不仅能改变座位值，还能驱动座位图刷新
                        // ES6语法,找到选中座位的索引值，利用splice函数删除,
                        //前者参数是开始删除的索引位置，后者是要删除的元素个数
                        // 这里的箭头函数属于现有流行编码风格，其实也可以写一个匿名函数进行回调
                        this.curSeat.splice(this.curSeat.findIndex(item=>item===index),1)
                    }
                    else if(vm.seatFlag[index]==0&&this.count<5){
                        // 如果点击的是空位置，且选中状态位置小于5，因为系统规定一个人最多只能订五张票
                        vm.$set(vm.seatFlag,index,2);
                        this.curSeat.push(index);//将参数推进选中状态的数组里
                    }
                    // 这个很关键，不然会出现叠加推入数组的情况，其实按效率来说，不应该写在这里
                    this.curSeatDisplay=[];    
                    for(let item of this.curSeat){
                        // 通过遍历选中数组，利用选中数组的数据计算出行列
                        // 最后推入选中座位行列展示数组
                        this.curSeatDisplay.push((Math.floor(item/this.seatCol)+1)+"行"
                        +(item%this.seatCol+1)+"列");
                    }

                    var mySeat=vm.seatFlag.filter(item=>{//item为数组当前元素
                        // 将选中状态的座位筛选到mySeat数组中
                        return item==2;//这个好像真比我在事件里count++--省事
                    });
                    this.count=mySeat.length;
                    // 处理一下选中数大于五时，给用户一点提示，不然用户可能意味是软件的问题,当然提示逻辑可以不用在这里写
                    if(this.count>=5){
                        this.maxFlag=true;
                    }else this.maxFlag=false;
                },

                shop(){
                    for(let item of this.curSeat){
                        // 将选中座位状态变成成功购买状态
                        vm.$set(vm.seatFlag,item,1);
                    }
                }
            }
        ,
        computed:{
            totalPrice:function(){
                return this.curSeat.length*this.movieInfo.unitPrice;
            }
        },
        filters:{
            priceFormat:function(value){
                return value.toFixed(2)+"元"
            }
        }
        })
    </script>
</html>